<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Algoritmos de Ordenación y Búsqueda</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

<div class="bg-white shadow-xl rounded-2xl p-8 w-full max-w-3xl">
    <h1 class="text-2xl font-bold mb-4 text-center text-blue-800">Proyecto Algoritmos – Java + Spring</h1>

    <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-xl">
        <div class="flex justify-between items-center mb-2">
            <label class="font-bold text-blue-700">Datos de prueba (100 números)</label>
            <button onclick="generarNuevosDatos()" class="text-xs bg-blue-200 hover:bg-blue-300 text-blue-800 px-2 py-1 rounded">Regenerar</button>
        </div>
        <textarea id="testData" readonly class="w-full text-xs p-2 bg-white border border-blue-200 rounded-md h-20 text-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-400" onclick="this.select()">Cargando datos...</textarea>
        <p class="text-[10px] text-blue-500 mt-1">* Haz clic para seleccionar todo y copiar.</p>
    </div>

    <label class="block font-semibold mb-1">Datos (separados por coma)</label>
    <input id="dataInput" type="text" placeholder="Ej: 8,3,5,1,9,2"
           class="w-full border rounded-lg p-2 mb-4 focus:ring-2 focus:ring-blue-500 outline-none" />

    <label class="block font-semibold mb-1">Elemento a buscar</label>
    <input id="keyInput" type="number" placeholder="Ej: 5"
           class="w-full border rounded-lg p-2 mb-4 focus:ring-2 focus:ring-blue-500 outline-none" />

    <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-6">
        <button onclick="ordenar('insercion')" class="btn">Inserción</button>
        <button onclick="ordenar('seleccion')" class="btn">Selección</button>
        <button onclick="ordenar('intercambio')" class="btn">Intercambio</button>
        <button onclick="ordenar('mergesort')" class="btn">MergeSort</button>
        <button onclick="ordenar('quicksort')" class="btn">QuickSort</button>
        <button onclick="ordenar('heapsort')" class="btn">HeapSort</button>
    </div>

    <div class="grid grid-cols-2 gap-3 mb-6">
        <button onclick="buscar('secuencial')" class="btn bg-green-600 hover:bg-green-700">Búsqueda Secuencial</button>
        <button onclick="buscar('binaria')" class="btn bg-green-600 hover:bg-green-700">Búsqueda Binaria</button>
    </div>

    <div class="bg-gray-50 p-4 rounded-lg">
        <p class="break-words"><strong>Resultado:</strong> <span id="resultado" class="text-blue-700 font-mono"></span></p>
        <p class="mt-2"><strong>Tiempo:</strong> <span id="tiempo" class="text-red-600 font-bold">0</span> ms</p>

        <button onclick="benchmarkOrdenamientos()" class="w-full mt-4 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 rounded-lg shadow-md transition">
            Benchmark (1000 ejecuciones promedio)
        </button>

        <div class="mt-6 bg-white p-4 rounded-xl shadow border border-gray-100">
            <h2 class="text-lg font-semibold mb-2 text-center text-gray-700">Promedio de tiempos por algoritmo</h2>
            <canvas id="grafico"></canvas>
        </div>
    </div>
</div>

<script>
    const baseUrl = 'http://localhost:8080/algoritmos';
    let chart;

    // Funcion para generar 100 nuimeros aleatorios
    function generarNuevosDatos() {
        const randomNumbers = Array.from({ length: 100 }, () => Math.floor(Math.random() * 500) + 1);
        document.getElementById('testData').value = randomNumbers.join(', ');
    }

    // Generar datos al cargar la pagina
    window.onload = generarNuevosDatos;

    function getArray() {
        return document.getElementById('dataInput').value
            .split(',')
            .map(n => parseInt(n.trim()))
            .filter(n => !isNaN(n));
    }

    async function ordenar(tipo) {
        const data = getArray();
        if(data.length === 0) return alert("Ingresa datos primero");

        const start = performance.now();
        try {
            const res = await fetch(`${baseUrl}/ordenacion/${tipo}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ data })
            });
            const result = await res.json();
            const end = performance.now();

            document.getElementById('resultado').innerText = result.join(', ');
            document.getElementById('tiempo').innerText = (end - start).toFixed(3);
        } catch (e) {
            console.error(e);
            alert("Error al conectar con el servidor Spring Boot");
        }
    }

    async function benchmarkOrdenamientos() {
        const algoritmos = ['insercion', 'seleccion', 'intercambio', 'mergesort', 'quicksort', 'heapsort'];
        const repeticiones = 1000;
        const resultados = {};
        const dataOriginal = getArray();

        if(dataOriginal.length === 0) return alert("Ingresa datos primero");

        algoritmos.forEach(a => resultados[a] = []);

        for (let i = 0; i < repeticiones; i++) {
            for (const alg of algoritmos) {
                const start = performance.now();
                await fetch(`${baseUrl}/ordenacion/${alg}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ data: [...dataOriginal] })
                });
                const end = performance.now();
                resultados[alg].push(end - start);
            }
        }

        const promedios = algoritmos.map(a => {
            const suma = resultados[a].reduce((x, y) => x + y, 0);
            return (suma / repeticiones).toFixed(3);
        });

        dibujarGrafico(algoritmos, promedios);
    }

    function dibujarGrafico(labels, data) {
        const ctx = document.getElementById('grafico').getContext('2d');
        if (chart) chart.destroy();

        chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels,
                datasets: [{
                    label: 'Tiempo promedio (ms)',
                    data,
                    backgroundColor: 'rgba(147, 51, 234, 0.7)',
                    borderColor: 'rgb(147, 51, 234)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true, title: { display: true, text: 'Milisegundos' } }
                }
            }
        });
    }

    async function buscar(tipo) {
        const data = getArray();
        const key = parseInt(document.getElementById('keyInput').value);
        if(isNaN(key)) return alert("Ingresa un número para buscar");

        const start = performance.now();
        const res = await fetch(`${baseUrl}/busqueda/${tipo}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ data, key })
        });

        const result = await res.json();
        const end = performance.now();

        document.getElementById('resultado').innerText = result >= 0
            ? `Encontrado en posición ${result}`
            : 'No encontrado';
        document.getElementById('tiempo').innerText = (end - start).toFixed(3);
    }
</script>

<style>
    .btn {
        @apply bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg transition shadow-sm active:scale-95;
    }
</style>

</body>
</html>